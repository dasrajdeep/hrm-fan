<html>
    <head>
        <title>HR Based Fan Controller</title>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-gH2yIJqKdNHPEq0n4Mqa/HGKIhSkIHeL5AyhkYV8i59U5AR6csBvApHHNl/vI1Bx" crossorigin="anonymous">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-A3rJD856KowSb7dwlZdYEkO39Gagi7vIsF0jrRAoQmDKKtQBHUuLZ9AsSv4jD4Xa" crossorigin="anonymous"></script>
        <script src="js/socket.io.min.js"></script>
        <script>
            var devices = {
                'sensor'    : [],
                'actuator'  : []
            };
            var socket = io();
            socket.on('device', function(dev) {
                console.log(dev);
                if(dev.id in devices[dev.type]) return;
                devices[dev.type].push(dev.id);
                if(dev.type == 'sensor') {
                    $('#sensors').append(
                        $('<option></option>')
                            .attr('value', dev.id)
                            .text(dev.name)
                    );
                } else if(dev.type == 'actuator') {
                    $('#actuators').append(
                        $('<option></option>')
                            .attr('value', dev.id)
                            .text(dev.name)
                    );
                }
            });
            socket.on('hrm', function(hrm) {
                $('#hr-display').show();
                $('#hr').text(hrm.hr);
            });
            $(document).ready(function() {
                $('#connect').on('click', function(e) {
                    e.preventDefault();
                    var sensorId = $('#sensors').val();
                    var actuatorId = $('#actuators').val();
                    console.log('Connecting to sensor...');
                    socket.emit('monitor', {
                        'sensor'        : sensorId,
                        'actuator'      : actuatorId,
                        'thresh'        : 130
                    });
                });
                $('#hr-thresh-high').on('change', function() {
                    var hrThresh = $(this).val();
                    $('#hr-thresh').text(hrThresh);
                });
            });
        </script>
    </head>
    <body>
        <div class="container-fluid text-center">
            <div id="devices">
                <div>
                    <span>Sensor</span>
                    <select id="sensors" class="form-select" aria-label="Sensor"></select>
                </div>
                <div>
                    <span>IoT Devices</span>
                    <select id="actuators" class="form-select" aria-label="IoT Devices"></select>
                </div>
            </div>
            <br>
            <div>
                <button id="connect" type="button" class="btn btn-primary">Connect</button>
            </div>
            <br>
            <div id="hr-display" style="display: none;">
                <h1>
                    Heart Rate
                    <br>
                    <small id="hr"></small>
                    <small> BPM</small>
                </h1>
                <div>
                    <label for="hr-thresh-high" class="form-label">Actuator Threshold</label>
                    <input type="range" class="form-range" min="60" max="220" value="130" id="hr-thresh-high">
                    <br>
                    <h2 id="hr-thresh">130</h2>
                </div>
            </div>
        </div>
    </body>
</html>